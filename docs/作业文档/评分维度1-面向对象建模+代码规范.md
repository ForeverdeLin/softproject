# 评分维度1：面向对象建模+代码规范（25%）

## 一、面向对象建模

### 1.1 UML建模完整性

本项目完成了完整的UML 2.x建模，包含以下三个核心图：

#### 1.1.1 用例图（Use Case Diagram）
- **参与者**：2个（普通用户、系统管理员）
- **用例数**：13个核心用例
  - 用户注册/登录
  - 发布失物/招领信息
  - 智能匹配（核心用例）
  - 查看匹配结果
  - 搜索查询
  - 个人信息管理
  - 标记已解决
  - 用户管理（管理员）
  - 信息审核（管理员）
- **关系**：包含关系（发布信息包含智能匹配）
- **位置**：`docs/作业文档/02-UML系统建模.md` 第1节

#### 1.1.2 类图（Class Diagram）
- **核心类数**：8个主要类
  - User（用户类）
  - LostItem（失物类）
  - FoundItem（招领类）
  - MatchRecord（匹配记录类）
  - RuleAgent（规则智能体类）
  - Matcher（匹配引擎类）
  - DatabaseManager（数据库管理类）
  - NotificationAgent（通知智能体类）
- **关系类型**：
  - 关联关系：User与LostItem/FoundItem（一对多）
  - 组合关系：RuleAgent包含Matcher、DatabaseManager、NotificationService
  - 依赖关系：各类依赖DatabaseManager进行数据操作
- **位置**：`docs/作业文档/02-UML系统建模.md` 第2节

#### 1.1.3 顺序图（Sequence Diagram）
- **核心流程**：3个主要顺序图
  1. 发布失物并触发智能匹配（展示完整的感知-决策-执行循环）
  2. 查看匹配结果
  3. 智能体决策详细流程
- **位置**：`docs/作业文档/02-UML系统建模.md` 第3节

### 1.2 建模工具与格式

- **工具**：PlantUML
- **格式**：PlantUML代码，可导出为PNG/SVG/PDF
- **在线工具**：http://www.plantuml.com/plantuml/uml/
- **VS Code插件**：PlantUML

---

## 二、面向对象设计原则

### 2.1 核心OOP概念应用

#### 2.1.1 封装（Encapsulation）
- **DatabaseManager类**：封装所有数据库操作，外部只需调用接口方法
- **Matcher类**：封装匹配算法实现，隐藏内部计算细节
- **AuthService类**：封装认证逻辑，包括密码加密

**示例代码位置**：
- `app/database/db_manager.py` - DatabaseManager类
- `app/agent/matcher.py` - Matcher类
- `app/auth/auth_service.py` - AuthService类

#### 2.1.2 继承（Inheritance）
- 数据库模型类继承自SQLAlchemy的`Base`类
- 位置：`app/database/models_db.py`

#### 2.1.3 多态（Polymorphism）
- 智能体系统设计支持不同的匹配策略（可扩展）
- RuleAgent和NotificationAgent都是智能体的具体实现

#### 2.1.4 抽象（Abstraction）
- 提取共同特征，定义抽象接口
- 智能体接口设计，便于扩展新的智能体类型

### 2.2 设计原则遵循

#### 2.2.1 单一职责原则（SRP）
- **Matcher类**：只负责匹配算法
- **DatabaseManager类**：只负责数据库操作
- **RuleAgent类**：只负责智能体循环逻辑
- **NotificationAgent类**：只负责通知管理

#### 2.2.2 开闭原则（OCP）
- 智能体系统易于扩展新的匹配规则
- 匹配规则可以独立添加，不影响现有代码

#### 2.2.3 依赖倒置原则（DIP）
- 高层模块（RuleAgent）不直接依赖低层模块（DatabaseManager）
- 通过接口和抽象类实现依赖

#### 2.2.4 接口隔离原则（ISP）
- 每个类只实现必要的接口
- 避免臃肿的接口设计

---

## 三、代码规范

### 3.1 Python代码规范（PEP 8）

#### 3.1.1 命名规范
- **类名**：大驼峰命名（PascalCase）
  - `RuleAgent`, `DatabaseManager`, `LostItem`
- **函数/方法名**：小写下划线命名（snake_case）
  - `match_cycle()`, `create_lost_item()`, `calculate_total_score()`
- **变量名**：小写下划线命名（snake_case）
  - `lost_item`, `found_items`, `match_score`
- **常量**：全大写下划线命名
  - `MAX_SCORE`, `MIN_THRESHOLD`

#### 3.1.2 代码格式
- **缩进**：使用4个空格（不使用Tab）
- **行长度**：每行不超过100字符
- **空行**：函数之间、类之间使用空行分隔
- **导入顺序**：标准库 → 第三方库 → 本地模块

#### 3.1.3 注释规范
- **文档字符串**：所有类和方法都有docstring
- **行内注释**：解释复杂逻辑
- **类型提示**：使用类型注解（Type Hints）

**示例**：
```python
def match_cycle(self, lost_item: LostItem, found_items: List[FoundItem]) -> List[MatchRecord]:
    """
    完整的感知-决策-执行循环
    
    参数：
        lost_item: 失物信息
        found_items: 招领信息列表
    
    返回：
        matches: 匹配记录列表（按分数降序）
    """
    matches: List[MatchRecord] = []
    for f in found_items:
        score = self.matcher.calculate_total_score(lost_item, f)
        if score >= 40.0:
            matches.append(MatchRecord(...))
    matches.sort(key=lambda m: m.match_score, reverse=True)
    return matches
```

### 3.2 模块化设计

#### 3.2.1 项目结构
```
softProject/
├── app/
│   ├── agent/              # 智能体模块
│   │   ├── matcher.py      # 匹配引擎
│   │   ├── rule_agent.py   # 规则智能体
│   │   └── notification_agent.py  # 通知智能体
│   ├── database/           # 数据库模块
│   │   ├── db.py           # 数据库连接
│   │   ├── db_manager.py   # 数据库操作
│   │   └── models_db.py    # 数据模型
│   ├── auth/               # 认证模块
│   │   ├── auth_service.py # 认证服务
│   │   └── session_manager.py  # 会话管理
│   ├── web/                # Web界面模块
│   │   ├── routes.py       # 路由
│   │   ├── templates/      # HTML模板
│   │   └── static/         # 静态文件
│   ├── main.py             # Flask主程序
│   └── models.py           # 业务模型
```

#### 3.2.2 模块职责划分
- **agent模块**：智能体相关功能
- **database模块**：数据库操作
- **auth模块**：用户认证
- **web模块**：Web界面和路由
- **models模块**：业务数据模型

### 3.3 代码质量

#### 3.3.1 代码复用
- 使用函数封装重复逻辑
- 使用类封装相关功能
- 避免代码重复（DRY原则）

#### 3.3.2 错误处理
- 使用try-except处理异常
- 提供有意义的错误信息
- 记录错误日志

#### 3.3.3 代码可读性
- 清晰的变量命名
- 适当的注释和文档字符串
- 逻辑结构清晰

---

## 四、核心类设计

### 4.1 数据模型类

#### 4.1.1 LostItem类
```python
@dataclass
class LostItem:
    """失物信息数据类"""
    item_id: Optional[int]
    user_id: Optional[int]
    item_name: str
    category: str
    lost_location: str
    lost_time: datetime
    description: str
    color: Optional[str] = None
    brand: Optional[str] = None
```
- **位置**：`app/models.py`
- **特点**：使用@dataclass装饰器，简化代码

#### 4.1.2 FoundItem类
- 类似结构，包含拾获地点和时间
- **位置**：`app/models.py`

#### 4.1.3 MatchRecord类
```python
@dataclass
class MatchRecord:
    """匹配记录数据类"""
    lost_item_id: int
    found_item_id: int
    match_score: float
    match_reason: str
```
- **位置**：`app/models.py`

### 4.2 智能体类

#### 4.2.1 RuleAgent类
- **职责**：实现感知-决策-执行循环
- **核心方法**：`match_cycle(lost_item, found_items) -> List[MatchRecord]`
- **依赖**：Matcher类进行匹配计算
- **位置**：`app/agent/rule_agent.py`

#### 4.2.2 Matcher类
- **职责**：实现5条匹配规则
- **核心方法**：
  - `match_by_category()`：类别匹配（40分）
  - `match_by_location()`：地点相似度（25分）
  - `match_by_time()`：时间匹配度（20分）
  - `match_by_features()`：特征相似度（15分）
  - `calculate_total_score()`：综合评分
- **位置**：`app/agent/matcher.py`

### 4.3 数据库管理类

#### 4.3.1 DatabaseManager类
- **职责**：封装所有数据库操作
- **核心方法**：
  - `create_lost_item()`：创建失物记录
  - `create_found_item()`：创建招领记录
  - `get_all_found_items()`：获取所有招领信息
  - `create_match_record()`：创建匹配记录
  - `get_match_records_by_lost_item()`：获取匹配结果
- **位置**：`app/database/db_manager.py`

---

## 五、软件架构设计

### 5.1 分层架构

```
┌─────────────────────────────────┐
│   Web界面层 (app/web/)          │
│   - routes.py (路由)           │
│   - templates/ (HTML模板)       │
└─────────────────────────────────┘
           ↓
┌─────────────────────────────────┐
│   业务逻辑层                     │
│   - 智能体模块 (app/agent/)     │
│   - 认证模块 (app/auth/)        │
└─────────────────────────────────┘
           ↓
┌─────────────────────────────────┐
│   数据访问层 (app/database/)    │
│   - db_manager.py               │
│   - models_db.py                │
└─────────────────────────────────┘
           ↓
┌─────────────────────────────────┐
│   数据持久层 (SQLite)            │
└─────────────────────────────────┘
```

### 5.2 架构特点

- **分层清晰**：每层职责明确
- **低耦合**：层与层之间通过接口交互
- **高内聚**：每层内部功能相关
- **易于扩展**：可以独立扩展某一层

---

## 六、总结

### 6.1 UML建模完成度
✅ **用例图**：13个用例，2个参与者，关系清晰  
✅ **类图**：8个核心类，关系完整  
✅ **顺序图**：3个核心流程，展示完整交互  

### 6.2 面向对象设计
✅ **OOP概念**：封装、继承、多态、抽象全部应用  
✅ **设计原则**：SRP、OCP、DIP、ISP全部遵循  
✅ **代码规范**：PEP 8规范，命名清晰，注释完整  

### 6.3 代码质量
✅ **模块化**：结构清晰，职责分明  
✅ **可读性**：代码易读，逻辑清晰  
✅ **可维护性**：易于修改和扩展  

---

**文档位置**：
- UML建模详细内容：`docs/作业文档/02-UML系统建模.md`
- 实验报告相关章节：`docs/作业文档/实验报告.txt` 第5、7章

