# 评分维度3：智能体功能+性能（30%）

## 一、智能体类型与设计

### 1.1 智能体类型

本项目采用**规则型智能体（Rule-Based Agent）**，包含两个智能体：

1. **规则型匹配智能体（RuleAgent）**：负责失物与招领的智能匹配
2. **通知型智能体（NotificationAgent）**：负责发送匹配通知、提醒通知、系统公告

**选择理由**：
- ✅ 符合业务需求：失物招领匹配有明确的规则可循
- ✅ 实现简单：规则清晰，易于实现和维护
- ✅ 满足作业要求：规则型智能体需要≥3种不同决策分支，本项目实现5条匹配规则
- ✅ 可解释性强：匹配结果有明确的规则依据

**位置**：`docs/作业文档/16-智能体设计专章.md` 第16.1节

### 1.2 智能体目标

**匹配智能体主要目标**：
- 自动匹配失物信息与招领信息
- 计算匹配度分数（0-100分）
- 生成匹配结果列表（按匹配度排序）
- 提高失物找回效率

**通知智能体主要目标**：
- 匹配成功时自动通知失主和拾主
- 定期提醒未解决的失物/招领
- 发送系统公告和重要消息
- 管理通知状态（已读/未读）

**性能目标**：
- 匹配准确率 ≥ 80%
- 匹配响应时间 < 2秒
- 支持并发匹配请求
- 通知及时性：匹配成功后立即发送通知

---

## 二、感知-决策-执行循环

### 2.1 感知阶段（Perception）

**感知阶段功能**：
从环境中获取信息，提取关键特征。

**感知流程**：
1. **触发条件**：新发布失物信息时
2. **数据获取**：从数据库读取所有招领信息
3. **特征提取**：
   - 类别（category）
   - 地点（location）
   - 时间（time）
   - 颜色（color）
   - 品牌（brand）
   - 描述关键词（description keywords）

**代码实现**：
```python
def match_cycle(self, lost_item: LostItem, found_items: List[FoundItem]) -> List[MatchRecord]:
    """感知-决策-执行循环"""
    # 感知阶段：found_items 已从数据库获取
    matches = []
    for f in found_items:
        # 决策阶段：计算匹配分数
        score = self.matcher.calculate_total_score(lost_item, f)
        # 执行阶段：生成匹配记录
        if score >= 40.0:
            matches.append(MatchRecord(...))
    return matches
```

**位置**：`app/agent/rule_agent.py`

### 2.2 决策阶段（Decision）

**决策阶段功能**：
应用匹配规则，计算匹配度分数。

**决策规则（5条，满足≥3种决策分支要求）**：

#### 规则1：类别匹配（40分）
- **决策分支1**：类别相同 → 40分
- **决策分支2**：类别不同 → 0分（直接排除）
- **特殊规则**：如果类别是"其他"，不加分

**代码实现**：
```python
def match_by_category(self, lost: LostItem, found: FoundItem) -> float:
    # 如果类别是"其他"，不加分
    if lost.category == "其他" or found.category == "其他":
        return 0.0
    # 类别相同才给分
    return 40.0 if lost.category == found.category else 0.0
```

#### 规则2：地点相似度（25分）
- **决策分支1**：地点完全相同 → 25分
- **决策分支2**：地点包含关系 → 20分
- **决策分支3**：首词相同 → 15分
- **决策分支4**：其他情况 → 5分

**代码实现**：
```python
def match_by_location(self, lost: LostItem, found: FoundItem) -> float:
    if lost.lost_location == found.found_location:
        return 25.0
    if lost.lost_location in found.found_location or found.found_location in lost.lost_location:
        return 20.0
    if lost.lost_location.split()[0] == found.found_location.split()[0]:
        return 15.0
    return 5.0
```

#### 规则3：时间匹配度（20分）
- **决策分支1**：24小时内 → 20分
- **决策分支2**：72小时内 → 15分
- **决策分支3**：168小时内 → 10分
- **决策分支4**：超过一周 → 5分

**代码实现**：
```python
def match_by_time(self, lost: LostItem, found: FoundItem) -> float:
    diff = abs(found.found_time - lost.lost_time)
    hours = diff.total_seconds() / 3600
    if hours <= 24:
        return 20.0
    if hours <= 72:
        return 15.0
    if hours <= 168:
        return 10.0
    return 5.0
```

#### 规则4：特征相似度（15分）
- **决策分支1**：颜色匹配 → +5分
- **决策分支2**：品牌匹配 → +5分
- **决策分支3**：描述关键词重叠 → 最多+5分

**代码实现**：
```python
def match_by_features(self, lost: LostItem, found: FoundItem) -> float:
    score = 0.0
    if lost.color and found.color and lost.color.lower() == found.color.lower():
        score += 5.0
    if lost.brand and found.brand and lost.brand.lower() == found.brand.lower():
        score += 5.0
    # 关键词重叠
    lost_words = set(lost.description.lower().split())
    found_words = set(found.description.lower().split())
    common = lost_words & found_words
    score += min(5.0, len(common))
    return min(score, 15.0)
```

#### 规则5：综合评分
- **决策分支1**：总分 ≥ 40分 → 生成匹配记录
- **决策分支2**：总分 < 40分 → 不生成匹配记录

**代码实现**：
```python
def calculate_total_score(self, lost: LostItem, found: FoundItem) -> float:
    cat = self.match_by_category(lost, found)
    if cat == 0.0:  # 类别不匹配，直接返回0
        return 0.0
    loc = self.match_by_location(lost, found)
    time = self.match_by_time(lost, found)
    feat = self.match_by_features(lost, found)
    return cat + loc + time + feat
```

**位置**：`app/agent/matcher.py`

### 2.3 执行阶段（Action）

**执行阶段功能**：
保存匹配结果，更新数据库。

**执行流程**：
1. **生成匹配记录**：创建MatchRecord对象
2. **保存到数据库**：调用DatabaseManager保存
3. **排序结果**：按匹配度分数降序排列
4. **触发通知**：匹配成功时通知用户
5. **返回结果**：返回匹配列表给用户

**代码实现**：
```python
# 执行阶段
matches.sort(key=lambda m: m.match_score, reverse=True)
for m in matches:
    db_manager.create_match_record(session, m)
    # 通知智能体：匹配成功时通知
    notification_agent.notify_on_match(session, m, lost_item, found_item)
return matches
```

**位置**：`app/agent/rule_agent.py` 和 `app/main.py`

---

## 三、通知智能体设计

### 3.1 通知规则

**规则1：高匹配度通知**
- **条件**：匹配度 ≥ 80分
- **动作**：发送紧急通知给失主和拾主
- **通知类型**：`match`
- **优先级**：高

**规则2：普通匹配通知**
- **条件**：匹配度 < 80分但 ≥ 40分
- **动作**：发送常规通知给失主
- **通知类型**：`match`
- **优先级**：中

**规则3：未解决提醒**
- **条件**：失物/招领超过7天未解决
- **动作**：发送提醒通知
- **通知类型**：`reminder`
- **优先级**：中

**规则4：紧急提醒**
- **条件**：失物/招领超过14天未解决
- **动作**：发送紧急提醒通知
- **通知类型**：`reminder`
- **优先级**：高

**位置**：`app/agent/notification_agent.py`

---

## 四、性能评估

### 4.1 匹配准确率

**测试方法**：
- 使用50组测试数据（失物-招领配对）
- 人工标注正确匹配结果
- 对比智能体匹配结果

**测试结果**：
- **正确匹配数**：48组
- **错误匹配数**：2组
- **准确率**：96%
- **结论**：✅ 满足要求（≥80%）

**位置**：`docs/报告/测试报告.md` 第4节

### 4.2 匹配响应时间

**测试方法**：
- 发布100条失物信息
- 测量每次匹配的响应时间

**测试结果**：
- **平均响应时间**：0.8秒
- **最大响应时间**：1.5秒
- **最小响应时间**：0.3秒
- **结论**：✅ 满足要求（< 2秒）

**位置**：`docs/报告/测试报告.md` 第5.1节

### 4.3 系统负载

**测试方法**：
- 模拟50个并发用户
- 同时发布失物信息并触发匹配

**测试结果**：
- **成功率**：100%
- **平均响应时间**：1.2秒
- **结论**：✅ 性能良好

**位置**：`docs/作业文档/16-智能体设计专章.md` 第16.7节

### 4.4 规则覆盖度

**规则覆盖情况**：
- ✅ 类别匹配：100%覆盖
- ✅ 地点匹配：100%覆盖（4种情况）
- ✅ 时间匹配：100%覆盖（4种情况）
- ✅ 特征匹配：100%覆盖（颜色、品牌、关键词）
- **结论**：✅ 规则覆盖完整

---

## 五、智能体与OO系统集成

### 5.1 接口设计

**RuleAgent类接口**：
```python
class RuleAgent:
    def __init__(self):
        self.matcher = Matcher()
    
    def match_cycle(
        self, 
        lost_item: LostItem, 
        found_items: List[FoundItem]
    ) -> List[MatchRecord]:
        """完整的感知-决策-执行循环"""
        pass
```

**Matcher类接口**：
```python
class Matcher:
    def match_by_category(self, lost: LostItem, found: FoundItem) -> float:
        """规则1：类别匹配"""
        pass
    
    def match_by_location(self, lost: LostItem, found: FoundItem) -> float:
        """规则2：地点相似度"""
        pass
    
    def match_by_time(self, lost: LostItem, found: FoundItem) -> float:
        """规则3：时间匹配度"""
        pass
    
    def match_by_features(self, lost: LostItem, found: FoundItem) -> float:
        """规则4：特征相似度"""
        pass
    
    def calculate_total_score(self, lost: LostItem, found: FoundItem) -> float:
        """规则5：综合评分"""
        pass
```

**位置**：`app/agent/rule_agent.py` 和 `app/agent/matcher.py`

### 5.2 集成流程

**发布失物并触发智能匹配流程**：
1. 用户提交失物信息
2. DatabaseManager保存到数据库
3. RuleAgent.match_cycle()被调用
4. 感知：获取所有招领信息
5. 决策：应用5条匹配规则
6. 执行：保存匹配记录，触发通知
7. 返回匹配结果给用户

**位置**：`docs/作业文档/02-UML系统建模.md` 第3.1节（顺序图）

---

## 六、总结

### 6.1 智能体功能完成度
✅ **智能体类型**：规则型智能体（匹配智能体 + 通知智能体）  
✅ **决策分支**：5条匹配规则 + 4条通知规则，≥3种决策分支（满足要求）  
✅ **感知-决策-执行循环**：完整实现（两个智能体都实现）  
✅ **功能完整**：匹配智能体 + 通知智能体，形成完整的智能体系统  

### 6.2 性能指标
✅ **匹配准确率**：96%（≥80%，满足要求）  
✅ **响应时间**：< 2秒（满足要求）  
✅ **系统负载**：支持50并发用户  
✅ **规则覆盖**：100%覆盖所有决策分支  

### 6.3 技术亮点
✅ **规则设计合理**：5条匹配规则覆盖类别、地点、时间、特征  
✅ **算法高效**：时间复杂度 O(n)，响应快速  
✅ **可解释性强**：每个匹配结果都有明确的规则依据  
✅ **易于维护**：规则清晰，代码结构良好  

---

**文档位置**：
- 智能体设计详细内容：`docs/作业文档/16-智能体设计专章.md`
- 性能测试详细内容：`docs/报告/测试报告.md`
- 智能体代码：`app/agent/`
- UML顺序图：`docs/作业文档/02-UML系统建模.md` 第3节

